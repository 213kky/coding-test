-- 코드를 입력하세요



SELECT C.CAR_ID, C.CAR_TYPE, ROUND(C.DAILY_FEE*30*(100-P.DISCOUNT_RATE)/100) AS FEE
FROM CAR_RENTAL_COMPANY_CAR C
JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN P ON P.CAR_TYPE = C.CAR_TYPE AND P.DURATION_TYPE = '30일 이상'
WHERE (C.CAR_TYPE = '세단' OR C.CAR_TYPE = 'SUV')
AND C.CAR_ID NOT IN(
    SELECT CAR_ID
    FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
    WHERE START_DATE <= '2022-11-30' AND END_DATE >= '2022-11-01'
)
AND ROUND((100-P.DISCOUNT_RATE)/100*30*C.DAILY_FEE) >= 500000 
AND ROUND((100-P.DISCOUNT_RATE)/100*30*C.DAILY_FEE) < 2000000 
GROUP BY C.CAR_ID
ORDER BY FEE DESC, C.CAR_TYPE ASC, C.CAR_ID DESC


# ((H.START_DATE < '2022-11-01' AND H.END_DATE < '2022-11-01') 
     # OR (H.START_DATE > '2022-11-30' OR H.END_DATE > '2022-11-30'))